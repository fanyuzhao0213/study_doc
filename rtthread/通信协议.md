## 1.IIC

### 1.1、归纳

- 总线上的所有设备通过软件寻址且具有唯一的地址（7位或10位）。7位“从机专用地址码”，其高4位为由生产厂家制定的**设备类型地址**，低3位为器件引脚定义地址（由使用者定义）；10位地址不常见；
- 任何时刻都只存在简单的主从关系，按数据传输的方向，主机可以是主发送器或主接收器；
- 支持多主机。在总线上存在多个主机时，通过冲突检测和仲裁机制防止多个主机同时发起数据传输时存在的冲突；
- IIC总线上所有器件都具有“自动应答”功能，保证数据传输的正确性； 主机和从机的区别在于对SCL的发送权，只有主机才能发送SCL；

### 1.2、信号和数据

- IIC 的数据读取动作都在 **SCL为高** 时产生，SCL为低时是数据改变的时期，无论SDA如何变化都不影响读取。所以，传输数据的过程中，当SCL为高时，数据应当保持稳定，避免数据的采集出错

**开始信号（START/S）**：scl为高时，sda从高变低的跳变产生开始信号

**结束信号（STOP/P）  ：** SCL为高时，SDA从低到高的跳变产生结束信号

**字节格式：**SDA数据线上的每个字节**必须是8位**，对于每次传输的**字节数没有限制**。每个字节（8位）数据传送完后紧跟着应答信号（ACK，第9位）。数据的先后顺序为：**高位在前** 。

**应答信号：**

协议规定数据传输过程必须包含应答（ACK）。接收器通过应答告知发送的字节已被成功接收，之后发送器可以进行下一个字节的传输。主机产生数据传输过程中的所有时钟，包括用于应答的第9个时钟。发送器在应答时钟周期内释放对SDA总线的控制，这样接收器可以通过将SDA线拉低告知发送器：数据已被成功接收。

应答信号分为两种：
    1）当第9位(应答位)为 低电平 时，为 ACK  （Acknowledge）   信号
    2）当第9位(应答位)为 高电平 时，为 NACK（Not Acknowledge）信号
从机发送数据，主机读取数据时，ACK信号由主机给出。主机响应ACK表示还需要再接收数据，而当主机接收完想要的数据后，通过发送NACK告诉从机读取数据结束、释放总线。随后主机发送STOP命令，将总线释放，结束读操作。